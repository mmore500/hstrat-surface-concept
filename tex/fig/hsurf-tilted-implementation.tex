\begin{figure}[htbp!]
  \centering

\begin{minipage}{\linewidth}
  \footnotesize
  \setlength{\tabcolsep}{2.5pt}
  % key-column + │ + 11 value columns = 12 columns total
  \begin{tabularx}{\linewidth}{@{}r|*{11}{Y}@{}}

  % ----------  T = 0–9 ----------
  { Time $\colorT$} &
    {0} & {1} & {2} & {3} & {4}
    & {5} & {6} & {7} & {8} & {9} & \ldots \\ \hline
  { \textit{Epoch} $\colort$} &
    \textit{0} & \textit{0} & \textit{0} & \textit{0} & \textit{0} & \textit{0} & \textit{0} & \textit{0} & \textit{0} & \textit{0} & \ldots \\
  { \textit{Meta-epoch} $\colortau$} &
    \textit{0} & \textit{0} & \textit{0} & \textit{0} & \textit{0} & \textit{0} & \textit{0} & \textit{0} & \textit{0} & \textit{0} & \ldots \\
  { \footnotesize \textit{Hanoi value} $\colorH(\colorT)$} &
    \textit{0} & \textit{1} & \textit{0} & \textit{2} & \textit{0} & \textit{1} & \textit{0} & \textit{3} & \textit{0} & \textit{1} & \ldots \\
  \rowcolor{lightgray!30}
  { \footnotesize \textbf{Buffer site} $\colorK(\colorT)$} &
    \textbf{0} & \textbf{1} & \textbf{9} & \textbf{2} & \textbf{6} & \textbf{10}
    & \textbf{13} & \textbf{3} & \textbf{5} & \textbf{7} & \ldots \\
  \multicolumn{12}{c}{} \\[1ex]

  % ----------  T = 10–19 ----------
  { $\colorT$} &
    {10} & {11} & {12} & {13} & {14}
    & {15} & {16} & {17} & {18} & {19} & \ldots \\ \hline
  { $\colort$} &
    \textit{0} & \textit{0} & \textit{0} & \textit{0} & \textit{0} & \textit{0} & \textit{1} & \textit{1} & \textit{1} & \textit{1} & \ldots \\
  { $\colortau$} &
    \textit{0} & \textit{0} & \textit{0} & \textit{0} & \textit{0} & \textit{0} & \textit{1} & \textit{1} & \textit{1} & \textit{1} & \ldots \\
  { $\colorH(\colorT)$} &
    \textit{0} & \textit{2} & \textit{0} & \textit{1} & \textit{0} & \textit{4} & \textit{0} & \textit{1} & \textit{0} & \textit{2} & \ldots \\
  \rowcolor{lightgray!30}
  { $\colorK(\colorT)$} &
    \textbf{8} & \textbf{11} & \textbf{12} & \textbf{14} & \textbf{15}
    & \textbf{4} & \textbf{0} & \textbf{1} & \textbf{9} & \textbf{8} & \ldots \\
  \multicolumn{12}{c}{} \\[1ex]

  % ----------  T = 20–29 ----------
  { $\colorT$} &
    {20} & {21} & {22} & {23} & {24}
    & {25} & {26} & {27} & {28} & {29} & \ldots \\ \hline
  { $\colort$} &
    \textit{1} & \textit{1} & \textit{1} & \textit{1} & \textit{1} & \textit{1} & \textit{1} & \textit{1} & \textit{1} & \textit{1} & \ldots \\
  { $\colortau$} &
    \textit{1} & \textit{1} & \textit{1} & \textit{1} & \textit{1} & \textit{1} & \textit{1} & \textit{1} & \textit{1} & \textit{1} & \ldots \\
  { $\colorH(\colorT)$} &
    \textit{0} & \textit{1} & \textit{0} & \textit{3} & \textit{0} & \textit{1} & \textit{0} & \textit{2} & \textit{0} & \textit{1} & \ldots \\
  \rowcolor{lightgray!30}
  { $\colorK(\colorT)$} &
    \textbf{6} & \textbf{10} & \textbf{13} & \textbf{12} & \textbf{0}
    & \textbf{7} & \textbf{9} & \textbf{15} & \textbf{6} & \textbf{14} & \ldots \\
  \multicolumn{12}{c}{} \\[1ex]

  % ----------  T = 30–39 ----------
  { $\colorT$} &
    {30} & {31} & {32} & {33} & {34}
    & {35} & {36} & {37} & {38} & {39} & \ldots \\ \hline
  { $\colort$} &
    \textit{1} & \textit{1} & \textit{2} & \textit{2} & \textit{2} & \textit{2} & \textit{2} & \textit{2} & \textit{2} & \textit{2} & \ldots \\
  { $\colortau$} &
    \textit{1} & \textit{1} & \textit{2} & \textit{2} & \textit{2} & \textit{2} & \textit{2} & \textit{2} & \textit{2} & \textit{2} & \ldots \\
  { $\colorH(\colorT)$} &
    \textit{0} & \textit{5} & \textit{0} & \textit{1} & \textit{0} & \textit{2} & \textit{0} & \textit{1} & \textit{0} & \textit{3} & \ldots \\
  \rowcolor{lightgray!30}
  { $\colorK(\colorT)$} &
    \textbf{13} & \textbf{5} & \textbf{0} & \textbf{1} & \textbf{9}
    & \textbf{2} & \textbf{0} & \textbf{10} & \textbf{9} & \textbf{3} & \ldots \\
  \end{tabularx}
  \vspace{-2ex}
\end{minipage}


\begin{subfigure}{\linewidth}
\caption{\footnotesize Site selection $\colorK(\colorT)$ for buffer size $\colorS=16$.}
\label{fig:hsurf-tilted-implementation-site-selection}
\end{subfigure}
\vspace{-3ex}

\begin{subfigure}[b]{\linewidth}
\includegraphics[width=\linewidth,trim={0 0 0 16.5cm},clip]{%
binder-20a-tilted-eulerian-surface/binder/teeplots/20a/font.family=serif+num-generations=256+strip-plotter=site_reservation_at_rank_stripped_heatmap+surface-size=16+viz=site-reservation-by-rank-spliced-at-heatmap+ext=.pdf}
\vspace{-4.5ex}\caption{\footnotesize
  Buffer composition over time from bottom to top, split by epoch with data items color-coded by \hv{} $\colorH(\colorTbar)$.
  Animated version at \url{https://hopth.ru/ef}.
}
\label{fig:hsurf-tilted-implementation-schematic}
\end{subfigure}

% \vspace{0.5ex}
% \begin{minipage}[]{\textwidth}
%  \vspace{-2pt}
%   \begin{subfigure}[t]{0.65\linewidth}
%     \vspace{0pt}
%     \centering
%   \includegraphics[width=0.88\linewidth,clip]{binder/teeplots/20/cnorm=log+num-generations=4096+surface-size=256+viz=site-ingest-depth-by-rank-heatmap+ynorm=linear+ext=.png}  % pdf cbar is scrambled
%   \end{subfigure}%
%   \begin{subfigure}[t]{0.35\linewidth}
%   \vspace{-2pt}
%   \caption{%
%     \footnotesize
%     Stored data item age across buffer sites for buffer size $\colorS=256$ from $\colorT=0$ to 4,096.
%   }
%   \label{fig:hsurf-tilted-implementation-heatmap}
% \end{subfigure}
% \end{minipage}

%   \vspace{-0.5ex}
%    \begin{minipage}[]{\textwidth}
%    \vspace{-2pt}
%   \begin{subfigure}[t]{0.65\linewidth}
%   \vspace{0pt}
%     \centering
%     \includegraphics[width=0.88\linewidth,clip]{binder/teeplots/20/num-generations=262144+surface-size=64+viz=stratum-persistence-dripplot+ext=.pdf}
%   \end{subfigure}%
%   \begin{subfigure}[t]{0.35\linewidth}
%   \vspace{-2pt}
%   \caption{%
%     \footnotesize
%     Data item retention time spans by ingestion time point for buffer size $\colorS=64$ from $\colorT=0$ to 3,000.
%   }
%   \label{fig:hsurf-tilted-implementation-dripplot}
%   \end{subfigure}
%   \end{minipage}

%   \vspace{-0.5ex}
%  \begin{minipage}[]{\textwidth}
%  \vspace{-2pt}
% \begin{subfigure}[t]{0.65\linewidth}
% \vspace{0pt}
%   \centering
%   \includegraphics[width=0.88\linewidth,clip]{binder/teeplots/20/hue=kind+surface-size=16+viz=criterion-satisfaction-lineplot+x=rank+y=tilted-criterion+ext=.pdf}
% \end{subfigure}%
% \begin{subfigure}[t]{0.35\linewidth}
% \vspace{-2pt}
% \caption{%
%   \footnotesize
%   Tilted criterion satisfaction across time points for buffer size $\colorS=16$.
% }
% \label{fig:hsurf-tilted-implementation-satisfaction}
% \end{subfigure}
% \end{minipage}

\vspace{-2ex}\caption{%
  \textbf{Example tilted-generalized ring buffer behavior.}
  \footnotesize
  Top panel \ref{fig:hsurf-tilted-implementation-site-selection} enumerates storage site selection on a 16-site buffer for $\colorT=0 \ldots 40$.
  Bottom panel \ref{fig:hsurf-tilted-implementation-schematic} depicts time course of stored data items, color-coded by data items' hanoi values $\colorH(\colorTbar)$.
  Time progresses from bottom to top.
  Between $\colorT=0$ and $\colorT=63$, time is segmented into epochs $\colort=0$, $\colort=1$, $\colort=2$, and $\colort=3$; strips before each epoch show hanoi values assigned to each buffer site during that epoch.
  Rectangles with small white ``$\blkhorzoval$'' symbol denote storage of ingested data item.
  In epoch 0, all sites are filled with a first data item.
  Then, in subsequent epochs, low \hv{} data items for which a newly-allocated reservation site is not available ``cycle'' within sites reserved for that \hv{} (ensuring most recent data items corresponding to that \hv{} are retained).
  % Heatmap panel \ref{fig:hsurf-tilted-implementation-heatmap} shows evolution of data item age at buffer sites.
  % Dripplot panel \ref{fig:hsurf-tilted-implementation-dripplot} shows retention spans for 3,000 ingested time points.
  % Vertical lines span durations between ingestion and elimination for data items from successive time points.
  % Time points previously eliminated are marked in red.
  % Lineplot panel \ref{fig:hsurf-tilted-implementation-satisfaction} shows tilted criterion satisfaction on a 16-bit surface over $2^{16}$ timepoints.
  % Lower and upper shaded areas are best- and worst-case bounds, respectively.
}
\label{fig:hsurf-tilted-implementation}

\end{figure}
